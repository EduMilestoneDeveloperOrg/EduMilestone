name: Android CI/CD Pipeline

# ğŸš€ Features Included in the CI/CD Pipeline
# ğŸš§ PR Restriction: Ensures only repository collaborators/members can raise PRs.
# ğŸ›¡ï¸ Security Scan (CodeQL): Runs CodeQL security analysis.
# ğŸ” Dependency Scan (Trivy): Scans dependencies for vulnerabilities.
# ğŸ¤– AI Code Review (Copilot): Enforces GitHub Copilot AI review on PRs.
# ğŸ“œ PR Description Enforcement: Ensures meaningful PR descriptions.
# ğŸ“‘ PR File Limit Enforcement: Restricts PRs modifying too many files.
# ğŸ¨ Linting (ktlint): Enforces Kotlin coding standards.
# âœ… Organization Owner Approval: Requires manual approval from the repository owner.
# ğŸš€ Build & APK Generation: Compiles the project and generates an APK.
# ğŸ§ª Unit Testing: Runs unit tests (optional but recommended).
# âœ… Final Merge Check: Ensures that all required jobs pass before PR approval.
# ğŸ”„ Fail-Fast Strategy: Prevents unnecessary job execution if a critical job fails.
# â³ Timeout Enforcement: Limits execution time to prevent long-running jobs.
# â™»ï¸ Resource Cleanup: Ensures that workspaces are cleaned after execution.
# ğŸ“¢ Notifications: Sends alerts in case of failures (Slack, email, etc.).
# ğŸ” Retry Mechanism: Retries transient failures automatically.
# âš¡ Parallelization: Runs independent jobs concurrently to speed up execution.
# ğŸ“¦ Dependency Caching: Caches Gradle dependencies to optimize build speed.


on:
  pull_request:
    types: [opened, synchronize, reopened, edited, ready_for_review]
    branches:
      - master
    paths:
      - '**'
  push:
    branches:
      - master

permissions:
  pull-requests: write
  contents: write
  security-events: write  # Required for CodeQL scanning
  actions: write
  statuses: write
  id-token: write

jobs:
  mega-linter:
    runs-on: ubuntu-latest
    permissions:
      contents: read  # To access the repository contents
      pull-requests: write  # To comment on PRs
  
    steps:
    # Step 1: Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v3
  
    # Step 2: Set up Python for MegaLinter
    - name: Set up Python 3.9
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'
  
    # Step 3: Install MegaLinter
    - name: Install MegaLinter
      run: |
        python -m pip install --upgrade pip
        pip install megalinter
  
    # Step 4: Run MegaLinter
    - name: Run MegaLinter
      run: |
        megalinter --install
        megalinter --run --ci --disable=all
  
    # Step 5: Upload MegaLinter report as artifact
    - name: Upload MegaLinter report artifact
      uses: actions/upload-artifact@v2.3.0  # Using v2.3.0 for artifact upload
      with:
        name: megalinter-report
        path: /tmp/lint/report/linters_logs
